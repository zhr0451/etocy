---
import Layout from '../../layouts/Layout.astro';
import type { CollectionEntry } from 'astro:content';
import { getCollection } from 'astro:content';

type DiaryEntry = CollectionEntry<'diary'>;

export async function getStaticPaths() {
	const entries = await getCollection('diary');
return entries.map((entry) => ({
	params: { slug: entry.slug },
	props: { entry }
}));
}

const { entry } = Astro.props as { entry: DiaryEntry };
const { Content } = await entry.render();

const formatDate = (value: Date) =>
	new Intl.DateTimeFormat('ru-RU', {
		day: 'numeric',
		month: 'long',
		year: 'numeric'
	}).format(value);

const entryTitle = `${entry.data.title} — дневник ${entry.data.author}`;
const entryDescription =
	entry.data.summary ??
	`Запись дневника ${entry.data.author} от ${formatDate(entry.data.date)} в кампании «Последствия Чумы Заклинаний».`;
---

<Layout title={entryTitle} description={entryDescription}>
	<article class="diary-entry">
		<header class="diary-entry__header">
			<p class="diary-entry__author">Автор: {entry.data.author}</p>
			<h1>{entry.data.title}</h1>
			<ul class="diary-entry__meta">
				<li>{formatDate(entry.data.date)}</li>
				{entry.data.location && <li>{entry.data.location}</li>}
				{entry.data.mood && <li>Настроение: {entry.data.mood}</li>}
			</ul>
			{entry.data.summary && <p class="diary-entry__summary">{entry.data.summary}</p>}
			{entry.data.tags.length > 0 && (
				<ul class="diary-entry__tags">
					{entry.data.tags.map((tag) => (
						<li>{tag}</li>
					))}
				</ul>
			)}
		</header>

		<section class="diary-entry__content">
			<Content />
		</section>

		<a class="diary-entry__back" href="/diary/lasm/">← К записям Ласм</a>
	</article>
</Layout>

<style>
	.diary-entry {
		display: grid;
		gap: 2rem;
	}

	.diary-entry__header {
		display: grid;
		gap: 0.85rem;
		padding: 2.1rem;
		border-radius: 22px;
		background:
			linear-gradient(135deg, var(--color-accent-soft), transparent 55%),
			var(--color-surface-strong);
		border: 1px solid var(--color-border-strong);
		box-shadow: 0 24px 46px var(--layer-shadow);
		position: relative;
	}

	.diary-entry__author {
		margin: 0;
		text-transform: uppercase;
		font-size: 0.75rem;
		letter-spacing: 0.1em;
		color: var(--color-link-active);
	}

	.diary-entry__meta {
		margin: 0;
		padding: 0;
		list-style: none;
		display: flex;
		flex-wrap: wrap;
		gap: 0.75rem;
		font-size: 0.95rem;
		color: var(--color-muted);
	}

	.diary-entry__summary {
		margin: 0;
		color: var(--color-muted);
		font-weight: 500;
	}

	.diary-entry__tags {
		margin: 0;
		padding: 0;
		list-style: none;
		display: flex;
		flex-wrap: wrap;
		gap: 0.4rem;
	}

	.diary-entry__tags li {
		padding: 0.25rem 0.65rem;
		border-radius: 999px;
		background: var(--color-tag-bg);
		color: var(--color-link-active);
		font-size: 0.75rem;
	}

	.diary-entry__content :global(p) {
		margin-bottom: 1rem;
		color: var(--color-muted);
	}

	.diary-entry__content :global(h2),
	.diary-entry__content :global(h3) {
		margin-top: 1.5rem;
		color: var(--color-link-active);
	}

	.diary-entry__content :global(ul),
	.diary-entry__content :global(ol) {
		padding-left: 1.2rem;
	}

	.diary-entry__back {
		font-weight: 600;
		color: var(--color-link-active);
	}

	@media (max-width: 640px) {
		.diary-entry__header {
			padding: 1.5rem;
		}

		.diary-entry__meta {
			flex-direction: column;
			gap: 0.5rem;
		}

		.diary-entry__content :global(p) {
			font-size: 0.95rem;
		}
	}
</style>
